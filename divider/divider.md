# é™¤æ³•å™¨è®¾è®¡

## åŽŸç†

å›žæƒ³ä¸€ä¸‹å°å­¦æ—¶æˆ‘ä»¬å¦‚ä½•åšé™¤æ³•è¿ç®—ï¼šä¾‹å¦‚ï¼Œè®¡ç®—1274âž—15ï¼š

```
          84
      ----------
  15 /  1274
        120
    ------------
          74
          60
    ------------
          14
```

äº‹å®žä¸Šï¼ŒäºŒè¿›åˆ¶çš„é™¤æ³•è¿ç®—ä¸Žåè¿›åˆ¶çš„è¿ç®—ååˆ†ç›¸ä¼¼ï¼Œä¸¾ä¾‹è®¡ç®—27âž—5ï¼š

```
              101   (5)
          ----------
 101 (5) /  11011   (27)
            101
        ------------
            0011
            0000
        ------------
              111
              101
        ------------
               10   (2)
```

é€šè¿‡è§‚å¯Ÿï¼Œå¯æ€»ç»“é™¤æ³•è¿ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼ˆä»…è€ƒè™‘æ— ç¬¦å·æ­£æ•°é™¤æ³•ï¼‰ï¼š

1. å–è¢«é™¤æ•°çš„é«˜å‡ ä½æ•°æ®ï¼Œä½å®½è¦ä¸Žé™¤æ•°ç›¸åŒã€‚
2. å°†è¢«é™¤æ•°é«˜ä½æ•°æ®ä¸Žé™¤æ•°ä½œæ¯”è¾ƒ
   1. å¦‚æžœå‰è€…ä¸å°äºŽåŽè€…ï¼Œåˆ™å¯å¾—åˆ°å¯¹åº”ä½çš„å•†ä¸º 1ï¼Œä¸¤è€…åšå·®å¾—åˆ°ç¬¬ä¸€æ­¥çš„ä½™æ•°
   2. å¦åˆ™å¾—åˆ°å¯¹åº”çš„å•†ä¸º 0ï¼Œå°†å‰è€…ç›´æŽ¥ä½œä¸ºä½™æ•°ã€‚
3. å°†ä¸Šä¸€æ­¥ä¸­çš„ä½™æ•°ä¸Žè¢«é™¤æ•°å‰©ä½™æœ€é«˜ä½ 1bit æ•°æ®æ‹¼æŽ¥æˆæ–°çš„æ•°æ®ï¼Œç„¶åŽå†å’Œé™¤æ•°åšæ¯”è¾ƒã€‚å¯ä»¥å¾—åˆ°æ–°çš„å•†å’Œä½™æ•°ã€‚
4. é‡å¤è¿‡ç¨‹ (3)ï¼Œç›´åˆ°è¢«é™¤æ•°æœ€ä½Žä½æ•°æ®ä¹Ÿå‚ä¸Žè®¡ç®—ã€‚

æ³¨æ„ï¼Œå•†çš„ä½å®½åº”è¯¥ä¸Žè¢«é™¤æ•°ä¿æŒä¸€è‡´ï¼Œå› ä¸ºé™¤æ•°æœ‰å¯èƒ½ä¸º1ï¼Œè€Œä½™æ•°çš„ä½å®½è‡³å¤šä¸Žé™¤æ•°ç›¸åŒã€‚æ­¤å¤–ï¼Œåœ¨å®žé™…ç¼–ç¨‹ä¸­ï¼Œç¬¬ä¸€æ­¥æ‰€è¦æ±‚çš„â€œå–å‡ºä½å®½ä¸Žé™¤æ•°ç›¸åŒçš„æ•°æ®â€éš¾ä»¥å®žçŽ°ï¼ˆè™½è¯´äººçœ¼å¯ä»¥çœ‹å‡ºä»Žå“ªé‡Œå¼€å§‹å¡«æ•°å­—ï¼Œä½†è®¡ç®—æœºä¸è¡Œï¼‰ã€‚ä½†ç¡¬ä»¶å¯ä»¥é‡‡å–æ›´ç¬¨æ‹™çš„åŠžæ³•â€”â€”é«˜ä½è¡¥0ã€‚å…ˆå–æ•°å­— 27 æœ€é«˜ä½ 1ï¼Œå†è¡¥ä¸¤ä¸ªå‰å¯¼0ï¼ˆå³3'b001ï¼‰ ä¸Ž 3'b101 åšæ¯”è¾ƒï¼Œæ­¤æ—¶å¾—åˆ°å•†0ï¼Œä¹Ÿä¸å½±å“ç»“æžœã€‚

æ ¹æ®æ­¤è®¡ç®—è¿‡ç¨‹ï¼Œè®¾è®¡ä½å®½å¯é…ç½®çš„æµæ°´çº¿å¼é™¤æ³•å™¨ï¼Œæµæ°´å»¶è¿Ÿå‘¨æœŸä¸ªæ•°ä¸Žè¢«é™¤æ•°ä½å®½ä¸€è‡´ã€‚

## å•æ­¥æµç¨‹

æˆ‘ä»¬è‚¯å®šæƒ³è¦å¾—åˆ°ä¸€ä¸ªèƒ½æµæ°´çš„é™¤æ³•å™¨ï¼ˆå¦åˆ™æ€§èƒ½å°±å¤ªå·®äº†ðŸ˜…ï¼‰ã€‚è€Œè®¾è®¡æµæ°´çº¿é™¤æ³•å™¨çš„**é‡ç‚¹å°±æ˜¯æ‰¾åˆ°å¯é‡å¤å¯æµæ°´çš„éƒ¨åˆ†**ï¼Œç„¶åŽé€šè¿‡è¾“å…¥è¾“å‡ºæ•°æ®çš„ä¸æ–­è¿­ä»£å¾—åˆ°ç»“æžœã€‚æ‰€ä»¥ä»€ä¹ˆä¸Šé¢çš„æµç¨‹ä¸­ï¼Œå“ªäº›æ˜¯å¯é‡å¤çš„å‘¢ï¼Ÿ

ä»”ç»†è§‚å¯Ÿé™¤æ³•æ­¥éª¤ï¼šè¢«é™¤æ•°çš„éƒ¨åˆ† bits æ¯æ¬¡éƒ½è¦ä¸Žé™¤æ•°æ¯”è¾ƒï¼Œç„¶åŽå†™ä¸‹å•†ï¼ˆ1æˆ–è€…0ï¼‰ï¼Œç„¶åŽå•†å’Œè¢«é™¤æ•°éƒ½éœ€è¦å³ç§»ä¸€ä½ï¼Œå†ç»§ç»­æ¯”è¾ƒã€‚

BTWï¼Œå…ˆæ˜Žç¡®ä¸€ä¸‹é™¤æ³•å™¨çš„è¾“å…¥è¾“å‡ºä¿¡å·ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬åŽç»­è®¨è®ºã€‚é™¤äº†å¿…è¦çš„é‚£äº›ï¼Œå½“ç„¶è¦æœ‰è¢«é™¤æ•° `[N-1:0] dividend` å’Œé™¤æ•° `[M-1:0] divisor`ï¼Œä»¥åŠå•† `[N-1:0] quotient` å’Œä½™æ•° `[M-1:0] remainder`ã€‚

```verilog
    input   clk,
    input   rstn,
    input   ready,

    input [N-1:0]   dividend,
    input [M-1:0]   divisor,

    output  res_ready,
    output [N-1:0]  quotient,
    output [M-1:0]  remainder
```

ä¸‡äº‹ä¿±å¤‡ï¼çŽ°åœ¨æˆ‘ä»¬æ¥ç”¨ verilog å®žçŽ°ä¸€ä¸‹**é™¤æ³•å™¨ä¸­æµæ°´çº¿çš„ä¸€çº§**ï¼š

> è¢«é™¤æ•°çš„éƒ¨åˆ† bits æ¯æ¬¡éƒ½è¦ä¸Žé™¤æ•°æ¯”è¾ƒï¼Œç„¶åŽå†™ä¸‹å•†ï¼ˆ1æˆ–è€…0ï¼‰ï¼Œç„¶åŽå•†å’Œè¢«é™¤æ•°éƒ½éœ€è¦å³ç§»ä¸€ä½ï¼Œå†ç»§ç»­æ¯”è¾ƒã€‚

å…¶å®žï¼ŒæŠ›å¼€ä¸€åˆ‡ç¹æ‚çš„ç»†èŠ‚ï¼ˆè¿™åªä¼šè®©æˆ‘ä»¬çŠ¹è±«ä¸å†³ï¼‰ï¼Œä¸Šè¿°è¯­è¨€è½¬åŒ–ä¸º verilog ä»£ç å…¶å®žå°±æ˜¯ï¼š

```verilog
input   clk,
input   rstn,
input   data_ready,

input [M:0]               dividend,
input [M-1:0]             divisor,
input [N-M:0]             merchant_ci , //ä¸Šä¸€çº§è¾“å‡ºçš„å•†
input [N-M-1:0]           dividend_ci , //åŽŸå§‹é™¤æ•°

output reg [N-M-1:0]      dividend_kp,  //åŽŸå§‹è¢«é™¤æ•°ä¿¡æ¯
output reg [M-1:0]        divisor_kp,   //åŽŸå§‹é™¤æ•°ä¿¡æ¯
output reg                rdy ,
output reg [N-M:0]        merchant ,  //è¿ç®—å•å…ƒè¾“å‡ºå•†
output reg [M-1:0]        remainder   //è¿ç®—å•å…ƒè¾“å‡ºä½™æ•°

if (dividend >= divisor) begin
    quotient    <= (quotient<<1) + 1'b1;    // å•†ä¸º1ï¼Œå³ç§»åŠ¨åŽå†™å…¥
    remainder   <= dividend - divisor;      // æ±‚ä½™
end else begin
    quotient    <= quotient<<1;         // å•†ä¸º0
    remainder   <= dividend;            // ä½™æ•°ä¸å˜
end
```

å½“ç„¶è¿™æ ·å†™è‚¯å®šæ˜¯ä¸å¯¹çš„ðŸ˜…ã€‚ä½†ä¸å¿…æ‹…å¿ƒï¼Œç¼–å†™ verilog ç¨‹åºæœ¬å°±æ˜¯ä¸æ–­è¯•é”™çš„è¿‡ç¨‹ã€‚ç„¶åŽï¼Œæˆ‘ä»¬åŠ ä¸Šå¤ä½å’Œéžreadyçš„æƒ…å†µï¼Œå®Œå–„ä¸Šé¢çš„ä»£ç ï¼š

```verilog
always@(posedge clk or negedge rstn) begin
    if (!rstn) begin
        res_ready <= 0;
        quotient  <= 0;
        remainder <= 0;
    end else if (data_ready) begin
        if (dividend >= divisor) begin
            quotient    <= (quotient<<1) + 1'b1;    // å•†ä¸º1ï¼Œå³ç§»åŠ¨åŽå†™å…¥
            remainder   <= dividend - divisor;      // æ±‚ä½™
        end else begin
            quotient    <= quotient<<1;         // å•†ä¸º0
            remainder   <= dividend;            // ä½™æ•°ä¸å˜
        end
    end else begin
        res_ready <= 0;
        quotient  <= 0;
        remainder <= 0;
    end
end
```